{% extends 'base.html' %}

{% block title %}My Tasks - Django ToDo{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-4 fw-bold text-primary">Task Master</h1>
    <p class="text-muted">Stay organized, focused, and get things done.</p>
</div>

<!-- Search and Filter Bar -->
        <div class="glass-card p-3 mb-4">
            <form method="GET" action="{% url 'home' %}" class="d-flex gap-2 flex-wrap align-items-center">
                <input type="text" name="search" class="form-control form-control-custom" placeholder="Search tasks..."
                    value="{{ search_query }}" style="flex: 2; min-width: 200px;">

                <select name="category" class="form-select form-control-custom" style="flex: 1; min-width: 120px;">
                    <option value="">All Categories</option>
                    {% for value, label in categories %}
                    <option value="{{ value }}" {% if category_filter == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>

                <select name="status" class="form-select form-control-custom" style="flex: 1; min-width: 120px;">
                    <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All Tasks</option>
                    <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
                    <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
                </select>

                <button type="submit" class="btn btn-primary-custom">
                    <i class="fa fa-search"></i> Filter
                </button>

                <a href="{% url 'home' %}" class="btn btn-outline-secondary" style="border-radius: 0.75rem;">
                    <i class="fa fa-refresh"></i> Clear
                </a>
            </form>
        </div>

<div class="row">
    <!-- Active Tasks -->
    <div class="col-md-7 mb-4">
        <div class="section-title">
            <i class="fa fa-sun-o text-warning"></i>
            <span>My Day</span>
            <small class="text-muted ms-2" style="font-size: 0.9rem; font-weight: 400;">{% now "jS F Y" %}</small>
        </div>

        

        <div style="height: 500px; overflow-y: auto; padding-right: 10px;">
            {% for task in tasks %}
            <div class="glass-card task-item">
                <div class="d-flex flex-column">
                    <div class="task-text">{{ task.task }}</div>
                    <div class="d-flex gap-2 mt-1">
                        <span class="badge bg-primary rounded-pill"
                            style="font-size: 0.7rem; opacity: 0.8;">{{task.category }}</span>
                        {% if task.due_date %}
                        <span class="badge bg-secondary rounded-pill" style="font-size: 0.7rem; opacity: 0.8;">
                            <i class="fa fa-calendar me-1"></i> {{ task.due_date|date:"M d" }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <a href="{% url 'mark_as_done' task.pk %}" class="btn-action btn-check-custom" title="Mark as Done">
                        <i class="fa fa-check"></i>
                    </a>
                    <a href="{% url 'edit_task' task.id %}" class="btn-action btn-edit-custom" title="Edit">
                        <i class="fa fa-pencil"></i>
                    </a>
                    <a href="{% url 'delete_task' task.id %}" class="btn-action btn-delete-custom" title="Delete">
                        <i class="fa fa-trash"></i>
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-5 text-muted">
                <i class="fa fa-clipboard fa-3x mb-3 opacity-25"></i>
                <p>No tasks for today. Enjoy your free time!</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Completed Tasks -->
    <div class="col-md-5">
        <div class="section-title">
            <i class="fa fa-check-circle text-success"></i>
            <span>Completed</span>
        </div>

        <div style="height: 500px; overflow-y: auto; padding-right: 10px;">
            {% for task in completed_tasks %}
            <div class="glass-card task-item completed-task" style="background: rgba(255,255,255,0.6);">
                <div class="task-text">{{ task.task }}</div>
                <div class="d-flex align-items-center">
                    <a href="{% url 'mark_as_undone' task.pk %}" class="btn-action btn-undo-custom" title="Undo">
                        <i class="fa fa-undo"></i>
                    </a>
                    <a href="{% url 'delete_task' task.id %}" class="btn-action btn-delete-custom" title="Delete">
                        <i class="fa fa-trash"></i>
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-5 text-muted">
                <i class="fa fa-check-square-o fa-3x mb-3 opacity-25"></i>
                <p>No completed tasks yet.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add Task Form -->
<div class="add-task-wrapper">
    <div class="add-task-card">
        <form action="{% url 'addTask' %}" method="POST" class="d-flex gap-2 align-items-center">
            {% csrf_token %}
            <input type="text" name="task" class="form-control form-control-custom" style="flex: 2;"
                placeholder="Add a new task..." required autocomplete="off">

            <select name="category" class="form-select form-control-custom" style="flex: 1; max-width: 130px;">
                <option value="General">General</option>
                <option value="Work">Work</option>
                <option value="Personal">Personal</option>
                <option value="Shopping">Shopping</option>
                <option value="Health">Health</option>
                <option value="Education">Education</option>
            </select>

            <input type="date" name="due_date" class="form-control form-control-custom"
                style="flex: 1; max-width: 150px;">

            <button type="submit" class="btn btn-primary-custom d-flex align-items-center gap-2">
                <i class="fa fa-plus"></i> Add
            </button>
        </form>
    </div>
</div>
{% endblock %}